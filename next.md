Recomendações priorizadas
[Alta] Blindar endpoints de gestão de chaves — Descrição: mover POST/DELETE /api/keys/* e GET /api/keys/user/:id para rotas autenticadas (sessão admin ou token assinado) e expor apenas validação pública; Risco: usuários externos conseguindo deletar/enumeração de chaves; Esforço: Médio (rotas, middleware e painel atingido); Benefício: elimina impacto crítico imediato; Validação: testes de integração garantindo 401/403 sem cookie admin e sucesso com sessão válida.
[Alta] Fortalecer autenticação admin — Descrição: exigir ADMIN_PASSWORD forte em produção, armazenar hash (argon2/bcrypt) e rejeitar execução se credenciais padrão forem usadas; Risco: invasão por credencial conhecida; Esforço: Médio-baixo (hash + guard clause); Benefício: reduz drasticamente risco de takeover; Validação: cobertura de testes unitários para hashing e verificação de que o app não sobe com senha default.
[Média] Persistir sessões e rate limit fora do processo — Descrição: trocar o Map interno por Redis/Upstash ou SQLite e configurar express-rate-limit com store compatível; Risco: logout involuntário e ausência de rate limit em ambientes multi-instância; Esforço: Médio (infra + configuração); Benefício: melhora segurança e confiabilidade; Validação: smoke test em clusters/vercel simulando múltiplas invocações mantendo sessão válida.
[Média] Ajustar CORS e CSP — Descrição: restringir CORS_ORIGIN a uma lista branca e remover 'unsafe-inline' do Helmet global, aplicando exceções só às páginas que precisam; Risco: abuso de credenciais e XSS; Esforço: Baixo; Benefício: endurece superfície sem quebrar API; Validação: requests CORS de origens não autorizadas retornam erro e páginas críticas continuam funcionando.
[Média] Limpar dependências e artefatos do dashboard (quick win) — Descrição: remover koban-free-api do package.json, apagar dist do versionamento e deixá-lo no .gitignore; Risco: builds mais lentos e risco de bundle indevido; Esforço: Baixo; Benefício: builds determinísticos e repositório enxuto; Validação: npm --prefix dashboard run build recompila do zero e o painel carrega normalmente.
[Baixa] Atualizar README e guias operacionais (quick win) — Descrição: corrigir a nota do build (npm --prefix dashboard install --no-audit --no-fund) e acrescentar alertas sobre senha obrigatória e proteção dos endpoints; Risco: confusão de devs; Esforço: Baixo; Benefício: DX alinhada ao código atual; Validação: revisão textual e checagem por outro membro do time.
Remoções sugeridas (código/arquivos/dependências)
package.json (dependência "koban-free-api") — Motivo: não há nenhum import/require no dashboard; Evidência: busca em todo o dashboard retornou apenas menções em package.json/lock; Risco: baixo (front-end não usa backend); Rollback: reinstalar dependência com npm install koban-free-api@file:.. se realmente precisar.
dist (artefatos gerados) — Motivo: build de produção gera essa pasta (npm --prefix dashboard run build); Evidência: arquivos minificados em dist/assets, já derivados de fontes JSX/CSS; Risco: baixo (recriável em segundos); Rollback: reexecutar o build se necessário e readicionar ao controle apenas em casos excepcionais.
Patches sugeridos (diffs mínimos)
*** Begin Patch *** Update File: package.json @@

"koban-free-api": "file:..", "react": "^18.3.1", "react-dom": "^18.3.1" }, *** End Patch
*** Begin Patch *** Update File: .gitignore @@ node_modules/ npm-debug.log* yarn-debug.log* yarn-error.log* +dashboard/dist/ *** End Patch

*** Begin Patch *** Update File: README.md @@ -Observação sobre lockfile no dashboard: o build usa npm --prefix dashboard ci. Se falhar por ausência de package-lock.json, troque para npm --prefix dashboard install localmente e/ou gere o lockfile. +Observação sobre lockfile no dashboard: o build já roda npm --prefix dashboard install --no-audit --no-fund antes do vite build. Garanta que o package-lock.json do dashboard esteja sincronizado; se houver divergência, execute npm --prefix dashboard install localmente para regenerá-lo. *** End Patch
